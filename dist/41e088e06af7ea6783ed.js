(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{68:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.show?i("div",{staticClass:"d-flex flex-column h-100"},[i("nav",{staticClass:"nav nav-tabs nav-justified sticky-top bg-main"},[i("a",{staticClass:"nav-item nav-link active",attrs:{"data-toggle":"tab",href:"#docs-manager"},on:{click:function(e){t.identity="student"}}},[t._v("学生")]),t._v(" "),i("a",{staticClass:"nav-item nav-link",attrs:{"data-toggle":"tab",href:"#docs-manager"},on:{click:function(e){t.identity="teacher"}}},[t._v("教师")])]),t._v(" "),i("div",{staticClass:"tab-content px-3 app-container flex-grow-1 app-scroll"},[i("div",{staticClass:"position-relative h-100 tab-pane fade show active",attrs:{id:"docs-manager"}},[i("table",{staticClass:"table table-fixed table-hover table-bordered text-center py-3"},[i("thead",{staticClass:"thead-light"},[i("tr",[i("th",[t._v("选择")]),t._v(" "),t._l(t.heads,(function(e,s){return i("th",{key:s,attrs:{scope:"col"}},[t._v(t._s(e.des))])})),t._v(" "),i("th",[t._v("上传文件")])],2)]),t._v(" "),i("tbody",[t.docs[t.identity].length?t._l(t.docs[t.identity],(function(e,s){return i("tr",{key:s,class:{editing:t.editing&&s==t.selected[0]}},[i("td",[i("div",{staticClass:"custom-control custom-checkbox"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.selected,expression:"selected"}],staticClass:"custom-control-input",attrs:{type:"checkbox",id:"checkbox-"+s,disabled:t.editing&&s!=t.selected[0]},domProps:{value:s,checked:Array.isArray(t.selected)?t._i(t.selected,s)>-1:t.selected},on:{change:function(e){var i=t.selected,n=e.target,a=!!n.checked;if(Array.isArray(i)){var d=s,c=t._i(i,d);n.checked?c<0&&(t.selected=i.concat([d])):c>-1&&(t.selected=i.slice(0,c).concat(i.slice(c+1)))}else t.selected=a}}}),t._v(" "),i("label",{staticClass:"custom-control-label",attrs:{for:"checkbox-"+s}})])]),t._v(" "),t._l(t.heads,(function(s,n){return i("td",{key:n,attrs:{title:e[s.key]}},[t._v(t._s(e[s.key]))])})),t._v(" "),i("td",[i("app-button",{staticClass:"btn btn-link py-0",attrs:{disabled:!t.editing||s!=t.selected[0]},nativeOn:{click:function(e){return t.getFile(e)}}},[t._v("上传文件")]),t._v(" "),i("input-file",{staticClass:"d-none",on:{change:function(e){return t.gotFile(s)}},model:{value:e.file,callback:function(i){t.$set(e,"file",i)},expression:"d.file"}})],1)],2)})):i("tr",[i("td",[t._v("暂无")]),t._v(" "),i("td",[t._v("暂无")]),t._v(" "),i("td",[t._v("暂无")]),t._v(" "),i("td",[t._v("暂无")]),t._v(" "),i("td",[t._v("暂无")])])],2)])])]),t._v(" "),i("div",{staticClass:"w-100 form-group d-flex justify-content-around border-top border-secondary py-3 mb-0"},[i("app-button",{staticClass:"btn btn-primary",attrs:{disabled:t.docs[t.identity].length<=0||t.adding||t.editing,type:"button"},nativeOn:{click:function(e){return t.select(e)}}},[i("i",{staticClass:"fa fa-check"}),t._v("反选\n    ")]),t._v(" "),i("app-button",{staticClass:"btn btn-warning",attrs:{disabled:t.selected.length<=0||t.adding||t.editing,type:"button",warn:"您确定要删除所选文件吗？"},nativeOn:{click:function(e){return t.remove(e)}}},[i("i",{staticClass:"fa fa-trash"}),t._v("删除\n    ")]),t._v(" "),i("app-button",{staticClass:"btn btn-secondary",attrs:{disabled:1!=t.selected.length||t.adding,type:"button"},nativeOn:{click:function(e){return t.edit(e)}}},[i("i",{staticClass:"fa fa-pencil"}),t._v("\n      "+t._s(t.editing?"确认":"修改")+"\n    ")]),t._v(" "),i("app-button",{staticClass:"btn btn-primary",attrs:{disabled:t.editing&&!t.adding,type:"button"},nativeOn:{click:function(e){return t.add(e)}}},[i("i",{staticClass:"fa fa-plus"}),t._v("\n      "+t._s(t.adding?"确认":"新增")+"\n    ")])],1)]):t._e()};s._withStripped=!0;var n={data:()=>({show:!1,identity:"student",heads:[{key:"filename",des:"文件名"},{key:"time",des:"更新时间"},{key:"count",des:"下载次数"}],docs:{student:[],teacher:[]},selected:[],editing:!1,adding:!1}),watch:{identity(){this.selected=[],this.editing=!1,this.adding=!1},selected(t,e){t.length<e.length&&(this.editing&&(this.editing=!1),this.adding&&(this.adding=!1,this.selected=[],this.docs[this.identity].pop()))}},methods:{async remove(){let t=await this.$axiosPost("/scsx/remove-doc",{indexes:this.selected,identity:this.identity});t.status&&(this.docs[this.identity]=this.docs[this.identity].filter((t,e)=>this.selected.indexOf(e)<0),this.selected=[]),this.$alertResult(t)},async add(){if(this.adding){let t=this.docs[this.identity][this.selected[0]],e=t.file[0];if(e){let i=new FormData;i.append("file",e),i.append("identity",this.identity);let s=await this.$axiosFile("/scsx/add-doc",i);s.status&&(this.editing=!1,this.adding=!1,this.selected=[],t.file=[]),this.$alertResult(s)}else this.$alertWarn("请选择文件！")}else{let t={filename:"",time:"",count:0,file:[]};this.selected=[this.docs[this.identity].push(t)-1],this.editing=!0,this.adding=!0,this.$nextTick(()=>{document.querySelector("tr.editing").scrollIntoView(!1)})}},async edit(){if(this.editing){let t=this.selected[0],e=this.docs[this.identity][t],i=e.file[0];if(i){let s=new FormData;s.append("file",i),s.append("identity",this.identity),s.append("index",t);let n=await this.$axiosFile("/scsx/edit-doc",s);n.status&&(this.editing=!1,this.selected=[],e.file=[]),this.$alertResult(n)}else this.$alertWarn("请选择文件！")}else this.editing=!0},select(){let t=this.docs[this.identity].length,e=[];for(let i=0;i<t;i++)this.selected.indexOf(i)<0&&e.push(i);this.selected=e},getFile(t){t.target.nextElementSibling.children[0].children[0].click()},gotFile(t){let e=this.docs[this.identity][t];e.filename=e.file[0].name,e.time=(new Date).toLocaleISOString()}},async created(){let t=await this.$axiosGet("/scsx/docs-templates");if(t.status){this.docs=t.docs;for(const t of["student","teacher"])for(const e of this.docs[t])e.file=[];this.show=!0}}},a=i(0),d=Object(a.a)(n,s,[],!1,null,null,null);d.options.__file="modules/scsx/components/docs-manage.vue";e.default=d.exports}}]);