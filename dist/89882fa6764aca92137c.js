(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{50:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.show?s("div",{staticClass:"d-flex flex-column h-100"},[s("nav",{staticClass:"nav nav-tabs nav-justified sticky-top bg-main"},[s("a",{staticClass:"nav-item nav-link active",attrs:{"data-toggle":"tab",href:"#user-manager"},on:{click:function(e){t.identity="student"}}},[t._v("学生")]),t._v(" "),s("a",{staticClass:"nav-item nav-link",attrs:{"data-toggle":"tab",href:"#user-manager"},on:{click:function(e){t.identity="teacher"}}},[t._v("教师")]),t._v(" "),s("a",{staticClass:"nav-item nav-link",attrs:{"data-toggle":"tab",href:"#user-manager"},on:{click:function(e){t.identity="admin"}}},[t._v("管理员")])]),t._v(" "),s("div",{staticClass:"tab-content px-3 app-container flex-grow-1 app-scroll"},[s("div",{staticClass:"position-relative h-100 tab-pane fade show active",attrs:{id:"user-manager"}},[t.users[t.identity].length?s("table",{staticClass:"table table-hover table-bordered text-center py-3"},[s("thead",{staticClass:"thead-light"},[s("tr",[s("th",[t._v("选择")]),t._v(" "),t._l(t.heads[t.identity],(function(e,i){return s("th",{key:i,attrs:{scope:"col"}},[t._v(t._s(e.des))])}))],2)]),t._v(" "),s("tbody",t._l(t.users[t.identity],(function(e,i){return s("tr",{key:e.id,class:{editing:t.editing&&e.id==t.selected[0],searching:t.searching==e.id}},[s("td",[s("div",{staticClass:"custom-control custom-checkbox"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.selected,expression:"selected"}],staticClass:"custom-control-input",attrs:{type:"checkbox",id:"checkbox-"+i,disabled:t.editing&&e.id!=t.selected[0]},domProps:{value:e.id,checked:Array.isArray(t.selected)?t._i(t.selected,e.id)>-1:t.selected},on:{change:function(s){var i=t.selected,n=s.target,a=!!n.checked;if(Array.isArray(i)){var d=e.id,r=t._i(i,d);n.checked?r<0&&(t.selected=i.concat([d])):r>-1&&(t.selected=i.slice(0,r).concat(i.slice(r+1)))}else t.selected=a}}}),t._v(" "),s("label",{staticClass:"custom-control-label",attrs:{for:"checkbox-"+i}})])]),t._v(" "),t._l(t.heads[t.identity],(function(i,n){return s("td",{key:n,attrs:{contenteditable:t.editing&&e.id==t.selected[0]}},[t._v(t._s(e[i.key]))])}))],2)})),0)]):s("div",{staticClass:"d-flex justify-content-center align-items-center text-muted",staticStyle:{height:"250px"}},[s("h1",[t._v("未找到用户！")])])])]),t._v(" "),s("div",{staticClass:"w-100 form-group d-flex justify-content-around border-top border-secondary py-3 mb-0"},[s("app-button",{staticClass:"btn btn-primary",attrs:{disabled:t.adding||t.editing,type:"button"},nativeOn:{click:function(e){return t.select(e)}}},[s("i",{staticClass:"fa fa-check"}),t._v("反选\n    ")]),t._v(" "),s("app-button",{staticClass:"btn btn-warning",attrs:{disabled:t.selected.length<=0||t.adding||t.editing,type:"button",warn:"您确定要删除所选用户吗？"},nativeOn:{click:function(e){return t.del(e)}}},[s("i",{staticClass:"fa fa-trash"}),t._v("删除\n    ")]),t._v(" "),s("app-button",{staticClass:"btn btn-primary",attrs:{disabled:t.editing&&!t.adding,type:"button"},nativeOn:{click:function(e){return t.add(e)}}},[s("i",{staticClass:"fa fa-plus"}),t._v("\n      "+t._s(t.adding?"确认":"新增")+"\n    ")]),t._v(" "),s("app-button",{staticClass:"btn btn-secondary",attrs:{disabled:1!=t.selected.length||t.adding,type:"button"},nativeOn:{click:function(e){return t.edit(e)}}},[s("i",{staticClass:"fa fa-pencil"}),t._v("\n      "+t._s(t.editing?"确认":"修改")+"\n    ")]),t._v(" "),s("div",{staticClass:"input-group col-12 col-md-4"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],staticClass:"form-control",attrs:{type:"search",placeholder:"输入用户姓名进行搜索...",required:""},domProps:{value:t.name},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search(e)},input:function(e){e.target.composing||(t.name=e.target.value)}}}),t._v(" "),s("div",{staticClass:"input-group-append"},[s("app-button",{staticClass:"btn btn-outline-success",attrs:{type:"button",disabled:t.adding||t.editing},nativeOn:{click:function(e){return t.search(e)}}},[s("i",{staticClass:"fa fa-search"}),t._v("搜索用户\n        ")])],1)])],1)]):t._e()};i._withStripped=!0;var n={data:()=>({show:!1,identity:"student",heads:{student:[{key:"name",des:"姓名"},{key:"gender",des:"性别"},{key:"schoolNum",des:"学号"},{key:"specialty",des:"专业"},{key:"group",des:"分组"},{key:"class",des:"小班"},{key:"postGraduate",des:"是否保研"}],teacher:[{key:"name",des:"姓名"},{key:"gender",des:"性别"},{key:"schoolNum",des:"工号"},{key:"proTitle",des:"职称"},{key:"group",des:"分组"},{key:"department",des:"教研室"},{key:"ifDean",des:"是否系主任"},{key:"ifHead",des:"是否班主任"}],admin:[{key:"name",des:"姓名"},{key:"gender",des:"性别"},{key:"priv",des:"权限等级"}]},users:{student:[],teacher:[],admin:[]},selected:[],name:"",editing:!1,adding:!1,searching:-2}),watch:{identity(){this.selected=[],this.editing=!1,this.adding=!1,this.searching=-2},selected(t,e){t.length<e.length&&(this.editing&&(this.editing=!1),this.adding&&(this.adding=!1,this.selected=[],this.users[this.identity].pop()))},name(t,e){0==t.length&&(this.searching=-2)}},methods:{getVals(){let t=document.querySelectorAll("tr.editing>td:not(:first-child)"),e={};for(const[s,i]of this.heads[this.identity].entries()){if(!t[s].innerText)return!1;e[i.key]=t[s].innerText}return e},async del(){let t=await this.$axiosPost("/system/del-user",{id:this.selected,identity:this.identity});t.status&&(this.users[this.identity]=this.users[this.identity].filter(t=>this.selected.indexOf(t.id)<0)),this.$alertResult(t)},async add(){if(this.adding){let t=this.getVals();if(t){let e=await this.$axiosPost("/system/add-user",{info:t,identity:this.identity});e.status&&(t.id=e.insertId,this.users[this.identity].pop(),this.$nextTick(()=>{this.users[this.identity].push(t)}),this.editing=!1,this.adding=!1,this.selected=[]),this.$alertResult(e)}else this.$alertWarn("请输入完整的信息！")}else{let t={};for(const e of this.heads[this.identity])t[e.key]="";t.id=-1,this.users[this.identity].push(t),this.selected=[-1],this.editing=!0,this.adding=!0,this.$nextTick(()=>{document.querySelector("tr.editing").scrollIntoView(!1)})}},async edit(){if(this.editing){let t=this.getVals();if(t){let e=await this.$axiosPost("/system/edit-user",{info:t,id:this.selected[0],identity:this.identity});e.status&&(this.editing=!1),this.$alertResult(e)}else this.$alertWarn("请输入完整的信息！")}else this.editing=!0},search(){for(const t of this.users[this.identity])if(t.name==this.name){this.searching=t.id,this.$nextTick(()=>{document.querySelector("tr.searching").scrollIntoView(!1)});break}},select(){let t=[];for(const e of this.users[this.identity])this.selected.indexOf(e.id)<0&&t.push(e.id);this.selected=t}},async created(){let t=await this.$axiosGet("/system/user-manage");t.status&&(this.users.student=t.users[0],this.users.teacher=t.users[1],this.users.admin=t.users[2]),this.show=!0}},a=s(0),d=Object(a.a)(n,i,[],!1,null,null,null);d.options.__file="modules/system/components/user-manage.vue";e.default=d.exports}}]);