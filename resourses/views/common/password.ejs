<!DOCTYPE html>
<html lang="zh_ch">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="icon" href="/pictures/favicon.ico">
    <link rel="stylesheet" href="/frames/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/system.css">
    <title>找回密码</title>
</head>

<body class="container" id="container">
    <div class="row align-items-center justify-content-center" id="row">
        <div class="col-12 col-sm-10 col-md-8 col-lg-6 col-xl-4">
            <form action="" id="retrievePW_form" method="POST">
                <div class="form-group form-row justify-content-around">
                    <p class="col-4 mb-0">身份：</p>
                    <div class="custom-control custom-radio custom-control-inline col-4 mr-0">
                        <input type="radio" name="identity" value="student" id="identity-s" class="custom-control-input"
                            checked>
                        <label for="identity-s" class="custom-control-label">Student</label>
                    </div>
                    <div class="custom-control custom-radio custom-control-inline col-4 mr-0">
                        <input type="radio" name="identity" value="teacher" id="identity-t"
                            class="custom-control-input">
                        <label for="identity-t" class="custom-control-label">Teacher</label>
                    </div>
                </div>
                <div class="form-group form-row">
                    <label class="col-3 col-form-label" for="account">账号：</label>
                    <input class="form-control col-9" type="number" name="account" id="account" placeholder="请输入你的账号"
                        pattern="\w{1,16}" required>
                </div>
                <div class="form-group form-row">
                    <label class="col-3 col-form-label" for="pin_code">验证码：</label>
                    <div class="input-group col-9 px-0">
                        <input class="form-control px-1" type="text" name="pinCode" id="pin_code" placeholder="请输入6位验证码"
                            pattern="\d{6}" required>
                        <div class="input-group-append">
                            <button id="pin_code_send" type="button" class="btn btn-outline-primary">发送验证码</button>
                        </div>
                    </div>
                </div>
                <div class="form-group form-row">
                    <label for="pw_new" class="col-3 col-form-label">新密码：</label>
                    <input name="newPW" id="pw_new" type="password" class="col-9 form-control"
                        placeholder="1~16位字母、数字或下划线" pattern="\w{1,16}" required>
                </div>
                <div class="form-group form-row">
                    <label for="pw_repeat" class="col-3 col-form-label">重复密码：</label>
                    <input name="repeatPW" id="pw_repeat" type="password" class="col-9 form-control"
                        placeholder="1~16位字母、数字或下划线" pattern="\w{1,16}" required>
                </div>
                <div class="form-row justify-content-between align-items-center mb-3">
                    <button class="btn btn-secondary col-12 col-md-4 mb-3 mb-md-0" type="reset">重置</button>
                    <button class="btn btn-primary col-12 col-md-4 mb-3 mb-md-0" type="submit">提交</button>
                </div>
            </form>
        </div>
    </div>
    <div class="modal p-3" id="alert_modal">
        <div class="alert alert-primary">
            <h4 class="alert-heading">找回密码成功，请使用新密码登陆！</h4>
            <p>将在<strong id="jump_counter" class="px-1">3</strong>秒后自动跳转至登陆界面,点击<a href="/"
                    class="alert-link">此处</a>立即跳转。</p>
        </div>
    </div>
    <%- include('./alert') %>
    <script src="/frames/others/jquery-3.4.0.js"></script>
    <script src="/frames/others/object_hash.js"></script>
    <script src="/frames/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/js/common.js"></script>
    <script>
        (function ($) {
            SASEE.sendPinCode({
                selector: '#pin_code_send',
                url: '/password/sendPinCode',
                dataFn: (form) => ({
                    identity: form.identity.value,
                    account: form.account.value
                })
            });
            SASEE.formSubmit({
                selector: '#retrievePW_form',
                url: '/password/retrieve',
                validate: $form => {
                    return $form[0].newPW.value == $form[0].repeatPW.value;
                },
                ifNotValid: $form => {
                    $($form[0].repeatPW).popover({
                        // selector: '#pw_repeat',
                        html: true,
                        content: '<h5 class="text-warning">密码不匹配！</h5>',
                        container: '#retrievePW_form',
                        placement: 'top'
                    }).popover('toggle');
                },
                done: msg => {
                    SASEE.counter({
                        count: 3,
                        doing: count => {
                            $('#jump_counter').text(count);
                        },
                        done: () => {
                            window.location.href = '/';
                        }
                    });
                    $('#alert_modal').modal({
                        backdrop: 'static',
                        keyboard: false
                    });
                }
            });
        })(window.jQuery);
    </script>
</body>

</html>